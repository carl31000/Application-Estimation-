<div id="app" style="max-width:520px;font-family:system-ui,-apple-system,Segoe UI,Roboto;margin:16px">
  <h2 style="margin:0 0 10px">Estimation express ‚Äì Carrelage / Fa√Øence</h2>

  <div style="margin:6px 0">
    <label><input type="radio" name="type" value="sol" checked> Carrelage sol</label>
    <label style="margin-left:12px"><input type="radio" name="type" value="mur"> Fa√Øence murale</label>
  </div>

  <div style="margin:6px 0">
    <label>Surface (m¬≤) :
      <input type="number" id="surface" value="0" min="0" step="0.1" style="width:100%;padding:8px;margin-top:4px">
    </label>
  </div>

  <div style="margin:6px 0">
    <label>Qualit√© :</label>
    <select id="quality" style="width:100%;padding:8px;margin-top:4px">
      <option value="bas">Entr√©e de gamme</option>
      <option value="moyen" selected>Moyenne gamme</option>
      <option value="haut">Haut de gamme</option>
    </select>
  </div>

  <div style="margin:6px 0">
    <label>Remarque (optionnel) :</label>
    <input type="text" id="note" placeholder="Ex : grand format, joints √©poxy, etc." style="width:100%;padding:8px;margin-top:4px">
  </div>

  <div id="output" style="margin-top:12px;padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#f9fafb">
    <p style="margin:0">PU estim√© : <strong id="pu">0 ‚Ç¨</strong></p>
    <p style="margin:6px 0 0">Total estim√© (HT) : <strong id="total">0 ‚Ç¨</strong></p>
    <p id="noteView" style="margin:6px 0 0;color:#475569;display:none"></p>
  </div>

  <button id="exportPDF" style="margin-top:10px;padding:10px 15px;background:#2563eb;color:#fff;border:none;border-radius:6px;cursor:pointer">
    üìÑ Exporter en PDF
  </button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
  const refs = {
    surface: document.getElementById('surface'),
    total: document.getElementById('total'),
    typeInputs: document.getElementsByName('type'),
    quality: document.getElementById('quality'),
    pu: document.getElementById('pu'),
    note: document.getElementById('note'),
    noteView: document.getElementById('noteView'),
    exportPDF: document.getElementById('exportPDF')
  };

  const PRICES = {
    sol: { bas: 50, moyen: 86, haut: 170 },
    mur: { bas: 40, moyen: 79, haut: 170 }
  };

  function euro(n){
    return (Number(n)||0).toLocaleString('fr-FR', { style: 'currency', currency: 'EUR' });
  }

  function calc(){
    const surf = parseFloat(refs.surface.value) || 0;
    const type = [...refs.typeInputs].find(r=>r.checked).value;
    const qual = refs.quality.value;
    const pu = PRICES[type][qual];
    refs.pu.textContent = euro(pu);
    refs.total.textContent = euro(surf * pu);

    const txt = refs.note.value.trim();
    if(txt){
      refs.noteView.style.display = 'block';
      refs.noteView.textContent = "Remarque : " + txt;
    }else{
      refs.noteView.style.display = 'none';
      refs.noteView.textContent = "";
    }
  }

  function exportPDF(){
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.setFontSize(16);
    doc.text("Estimation express ‚Äì Carrelage / Fa√Øence", 10, 20);
    doc.setFontSize(12);

    const type = [...refs.typeInputs].find(r=>r.checked).nextSibling.textContent.trim();
    doc.text("Type : " + type, 10, 30);
    doc.text("Surface : " + refs.surface.value + " m¬≤", 10, 40);
    doc.text("Qualit√© : " + refs.quality.options[refs.quality.selectedIndex].text, 10, 50);
    doc.text("PU estim√© : " + refs.pu.textContent, 10, 60);
    doc.text("Total estim√© (HT) : " + refs.total.textContent, 10, 70);

    if(refs.note.value.trim()){
      doc.text("Remarque : " + refs.note.value.trim(), 10, 80);
    }

    doc.save("estimation.pdf");
  }

  refs.surface.addEventListener('input', calc);
  refs.quality.addEventListener('change', calc);
  refs.note.addEventListener('input', calc);
  refs.typeInputs.forEach(r => r.addEventListener('change', calc));
  refs.exportPDF.addEventListener('click', exportPDF);

  calc();
</script>